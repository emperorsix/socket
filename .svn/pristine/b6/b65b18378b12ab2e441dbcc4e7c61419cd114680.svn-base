package com.zhangxuan.net.socket.convergence;

import java.io.File;
import java.io.FileInputStream;
import java.util.ArrayList;
import java.util.Hashtable;

import com.google.gson.Gson;

public class Config {

	private HostInfo info = new HostInfo();
	private Hashtable<String, HostInfo> hosts = new Hashtable<>();
	private ArrayList<String> trustedHost = new ArrayList<>();

	public HostInfo getInfo() {
		return info;
	}

	public void setInfo(HostInfo info) {
		this.info = info;
	}

	public Hashtable<String, HostInfo> getHosts() {
		return hosts;
	}

	public void setHosts(Hashtable<String, HostInfo> hosts) {
		this.hosts = hosts;
	}

	public ArrayList<String> getTrustedHost() {
		return trustedHost;
	}

	public void setTrustedHost(ArrayList<String> trustedHost) {
		this.trustedHost = trustedHost;
	}

	public static Config load(String configFileName) {
		String configString = null;
		FileInputStream fis = null;
		File file = new File(configFileName);
		if (!file.exists())
			return null;
		Long length = file.length();
		if (length == 0)
			return null;
		try {
			fis = new FileInputStream(file);
			byte[] bs = new byte[length.intValue()];
			fis.read(bs);
			configString = new String(bs);
		} catch (Exception e) {
			return null;
		} finally {
			if (fis != null)
				try {
					fis.close();
				} catch (Exception e2) {
				} finally {
					fis = null;
				}
		}
		if (configString.length() == 0)
			return null;
		Gson gson = new Gson();
		Config config = null;
		try {
			config = gson.fromJson(configString, Config.class);
			return config;
		} catch (Exception e) {
		}
		return null;
	}

	public static void main(String[] args) {
		Config config = new Config();
		HostInfo myinfo = new HostInfo();
		config.setInfo(myinfo);
		Hashtable<String, HostInfo> hosts = new Hashtable<>();
		config.setHosts(hosts);
		ArrayList<String> trustedHosts = new ArrayList<>();
		config.setTrustedHost(trustedHosts);

		myinfo.setId("huanglw");
		myinfo.setHost("192.168.168.55");
		myinfo.setPort(5555);
		myinfo.setSecurityCode("HUANGLW");

		HostInfo h1 = new HostInfo("hxh", "192.168.168.94", 5555, "HUANGXIANHONG");
		HostInfo h2 = new HostInfo("lq", "192.168.168.91", 5555, "LONGQING");
		hosts.put(h1.getId(), h1);
		hosts.put(h2.getId(), h2);

		trustedHosts.add("192.168.168.");
		trustedHosts.add("111.111.");

		Gson gson = new Gson();
		System.out.println(gson.toJson(config));
	}
}
